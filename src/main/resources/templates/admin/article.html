<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:v="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"  />
		<meta charset="utf-8" />
		<title>文章管理</title>

		<meta name="description" content="" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

		<!-- bootstrap & fontawesome -->
		<link rel="stylesheet" href="/admin/assets/css/bootstrap.min.css" />
		<link rel="stylesheet" href="/admin/assets/font-awesome/4.5.0/css/font-awesome.min.css" />
		<!-- page specific plugin styles -->
		<link rel="stylesheet" href="/admin/assets/css/sweetalert.css" />
		<link rel="stylesheet" href="/admin/assets/css/chosen.min.css" />
		<!-- text fonts -->
		<link rel="stylesheet" href="/admin/assets/css/fonts.googleapis.com.css" />

		<!-- ace styles -->
		<link rel="stylesheet" href="/admin/assets/css/ace.min.css" class="ace-main-stylesheet" id="main-ace-style" />

		<!--[if lte IE 9]>
        <link rel="stylesheet" href="/admin/assets/css/ace-part2.min.css" class="ace-main-stylesheet"/>
        <![endif]-->
		<link rel="stylesheet" href="/admin/assets/css/ace-skins.min.css" />
		<link rel="stylesheet" href="/admin/assets/css/ace-rtl.min.css" />

		<!--[if lte IE 9]>
        <link rel="stylesheet" href="/admin/assets/css/ace-ie.min.css"/>
        <![endif]-->

		<!-- inline styles related to this page -->

		<!-- ace settings handler -->
		<script src="/admin/assets/js/ace-extra.min.js"></script>

		<!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->

		<!--[if lte IE 8]>
        <script src="/admin/assets/js/html5shiv.min.js"></script>
        <script src="/admin/assets/js/respond.min.js"></script>
        <![endif]-->
		<style>
			.highlight {
				background-color: skyblue;
			}
		</style>
	</head>

	<body class="no-skin">
		<div id="navbar" class="navbar navbar-default     ace-save-state">
			<div class="navbar-container ace-save-state" id="navbar-container">
				<button type="button" class="navbar-toggle menu-toggler pull-left" id="menu-toggler" data-target="#sidebar">
					<span class="sr-only">Toggle sidebar</span>

					<span class="icon-bar"></span>

					<span class="icon-bar"></span>

					<span class="icon-bar"></span>
				</button>

				<div class="navbar-header pull-left">
					<a href="/admin/index/page" class="navbar-brand">
						<small>
							<i class="fa fa-leaf"></i>
							Blog 后台管理
						</small>
					</a>
				</div>

				<div class="navbar-buttons navbar-header pull-right" role="navigation">
					<ul class="nav ace-nav">
						<li class="light-blue dropdown-modal">
							<a data-toggle="dropdown" href="#" class="dropdown-toggle">
								<img class="nav-user-photo" src="/admin/assets/images/avatars/user.png" alt="Jason's Photo" />
								<span class="user-info">
									<small>欢迎,</small>
									管理员
								</span>

								<i class="ace-icon fa fa-caret-down"></i>
							</a>

							<ul class="user-menu dropdown-menu-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">

								<li>
									<a href="#">
										<i class="ace-icon fa fa-power-off"></i>
										退出
									</a>
								</li>
							</ul>
						</li>
					</ul>
				</div>
			</div><!-- /.navbar-container -->
		</div>

		<div class="main-container ace-save-state" id="main-container">
			<script type="text/javascript">
				try{ace.settings.loadState('main-container')}catch(e){}
			</script>

			<div id="sidebar" class="sidebar                  responsive                    ace-save-state">
				<script type="text/javascript">
					try{ace.settings.loadState('sidebar')}catch(e){}
				</script>

				<div class="sidebar-shortcuts" id="sidebar-shortcuts">
					<div class="sidebar-shortcuts-large" id="sidebar-shortcuts-large">
						<button class="btn btn-success">
							<i class="ace-icon fa fa-signal"></i>
						</button>

						<button class="btn btn-info">
							<i class="ace-icon fa fa-pencil"></i>
						</button>

						<button class="btn btn-warning">
							<i class="ace-icon fa fa-users"></i>
						</button>

						<button class="btn btn-danger">
							<i class="ace-icon fa fa-cogs"></i>
						</button>
					</div>

					<div class="sidebar-shortcuts-mini" id="sidebar-shortcuts-mini">
						<span class="btn btn-success"></span>

						<span class="btn btn-info"></span>

						<span class="btn btn-warning"></span>

						<span class="btn btn-danger"></span>
					</div>
				</div><!-- /.sidebar-shortcuts -->

				<ul class="nav nav-list">
					<li class="">
						<a href="/admin/index/page">
							<i class="menu-icon fa fa-home"></i>
							<span class="menu-text"> 首 页 </span>
						</a>

						<b class="arrow"></b>
					</li>
					<li class="active">
						<a href="/admin/article/page" >
							<i class="menu-icon fa fa-pencil-square-o"></i>
							<span class="menu-text"> 文章管理 </span>
						</a>
					</li>
					<li class="">
						<a href="/admin/category/page" >
							<i class="menu-icon fa fa-list"></i>
							<span class="menu-text"> 分类管理 </span>
						</a>
					</li>
					<li class="">
						<a href="/admin/tag/page" >
							<i class="menu-icon fa fa-tags"></i>
							<span class="menu-text"> 标签管理 </span>
						</a>
					</li>
					<li class="">
						<a href="/admin/article/comment/page" >
							<i class="menu-icon fa fa-comments-o"></i>
							<span class="menu-text"> 评论管理 </span>
						</a>
					</li>

					<li class="">
						<a href="/admin/comment/page">
							<i class="menu-icon fa fa-envelope"></i>
							<span class="menu-text"> 留言管理 </span>
						</a>
					</li>

					<li class="">
						<a href="/admin/view/page">
							<i class="menu-icon fa fa-eye"></i>
							<span class="menu-text"> 访问记录 </span>
						</a>
					</li>

					<li class="">
						<a href="/admin/log/page">
							<i class="menu-icon fa fa-book"></i>
							<span class="menu-text"> 日志查看 </span>
						</a>
					</li>

					<li class="">
						<a href="/admin/setting/page">
							<i class="menu-icon fa fa-cog"></i>
							<span class="menu-text"> 设 置 </span>
						</a>
					</li>
				</ul><!-- /.nav-list -->

				<div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse">
					<i id="sidebar-toggle-icon" class="ace-icon fa fa-angle-double-left ace-save-state" data-icon1="ace-icon fa fa-angle-double-left" data-icon2="ace-icon fa fa-angle-double-right"></i>
				</div>
			</div>

			<div class="main-content">
				<div class="main-content-inner">
					<div class="page-content">
						<div class="row">
							<!--添加文章页面-->
							<div class="cod-md-12" id="addArticleDiv" style="display: none">
								<h4 class="header green clearfix">添加文章</h4>
								<div class="col-md-12 form-group">
									<input type="text" class="col-md-8" id="addTitle" placeholder="这里是标题">
								</div>
								<div class="col-md-12 form-group">
									<textarea class="col-md-8" placeholder="这里是简介" id="addSummary"></textarea>
								</div>
								<div class="col-md-12 form-group">
									<div class="col-md-6">
										<input type="file"  class="uploadFile" id="addPictureUrl" >
									</div>
									<div class="col-md-offset-7">
										<input type="button" value="上传封面" class="btn btn-info " onclick="uploadPicture($('#addPictureUrl'))">
									</div>
								</div>
								<div class="col-md-12 form-group">
									<textarea class="ck-editor"  id="addContent" rows="30"></textarea>
									<div class="hr hr-double dotted"></div>
								</div>
								<div class="col-md-2 form-group">
									<div class="row  " style="text-align: center">
										<label class="control-label border " for="addTop">是否置顶: </label>
										<label><input type="radio" class="ace" value="true" id="addTop"name="addTop"><span class="lbl">是</span></label>
										<label><input type="radio" class="ace" value="false" name="addTop" checked="checked"><span class="lbl">否</span></label>
									</div>

								</div>
								<div class="col-md-2 form-group">
									<div class="row  "  style="text-align: center">
										<label class="control-label border " >是否隐私: </label>
										<label><input type="radio" class="ace" value="true" id="addPrivate"name="addPrivate"><span class="lbl">是</span></label>
										<label><input type="radio" class="ace" value="false" name="addPrivate" checked="checked"><span class="lbl">否</span></label>
									</div>

								</div>
								<div class="col-md-2 form-group">
									<div class="row " style="text-align: center">
										<label class="control-label border " for="addCategoryId">所属分类: </label>
										<select id="addCategoryId"></select>
									</div>
								</div>
								<div class="col-md-2 form-group">
									<div class="row " style="text-align: center">
										<input type="text" name="tags" id="addTags"  placeholder="输入标签" />
									</div>
								</div>
								<div class="col-md-3 form-group">
									<div class="row " style="text-align: center">
										<label class="control-label border " for="updateTraffic">点击量: </label>
										<input type="number" value="0" placeholder="点击量" id="addTraffic">
									</div>
								</div>
								<div class="row form-group" >
									<div class="col-md-4 col-md-offset-5">
										<button  class="btn btn-primary"  onclick="submitAdd()">提交</button>
										<button  class="btn btn-default " onclick="returnBack($('#addArticleDiv'))">取消</button>
									</div>
								</div>
							</div>
							<!--修改文章-->
                            <div class="cod-md-12" id="updateArticleDiv" style="display: none">
                                <h4 class="header blue clearfix">修改文章</h4>
                                <div class="col-md-12 form-group">
                                    <input type="number" class="col-md-8" id="updateId" disabled="disabled">
                                </div>
                                <div class="col-md-12 form-group">
                                    <input type="text" class="col-md-8" id="updateTitle" placeholder="这里是标题">
                                </div>
                                <div class="col-md-12 form-group">
                                    <textarea class="col-md-8" placeholder="这里是简介" id="updateSummary"></textarea>
                                </div>
                                <div class="col-md-12 form-group">
                                    <div class="col-md-6">
                                        <input type="file"  class="uploadFile" id="updatePictureUrl" >
                                    </div>
                                    <div class="col-md-offset-7">
                                        <input type="button" value="上传封面" class="btn btn-info " onclick="uploadPicture($('#updatePictureUrl'))">
                                    </div>
                                </div>
                                <div class="col-md-12 form-group">
                                    <textarea class="ck-editor"  id="updateContent" rows="30"></textarea>
                                    <div class="hr hr-double dotted"></div>
                                </div>
                                <div class="col-md-2 form-group">
                                    <div class="row  " style="text-align: center">
                                        <label class="control-label border " for="updateTop">是否置顶: </label>
                                        <label><input type="radio" class="ace" value="true" id="updateTop"name="updateTop"><span class="lbl">是</span></label>
                                        <label><input type="radio" class="ace" value="false" name="updateTop" checked="checked"><span class="lbl">否</span></label>
                                    </div>

                                </div>
								<div class="col-md-2 form-group">
									<div class="row  "  style="text-align: center">
										<label class="control-label border " >是否隐私: </label>
										<label><input type="radio" class="ace" value="true" id="updatePrivate"name="updatePrivate"><span class="lbl">是</span></label>
										<label><input type="radio" class="ace" value="false" name="updatePrivate" checked="checked"><span class="lbl">否</span></label>
									</div>

								</div>
                                <div class="col-md-2 form-group">
                                    <div class="row " style="text-align: center">
                                        <label class="control-label border " for="updateCategoryId">所属分类: </label>
                                        <select id="updateCategoryId"></select>
                                    </div>
                                </div>
								<div class="col-md-2 form-group">
									<div class="row " style="text-align: center">
										<input type="text" name="tags" id="updateTags"  placeholder="输入标签" />
									</div>
								</div>
                                <div class="col-md-3 form-group">
                                    <div class="row " style="text-align: center">
                                        <label class="control-label border " for="updateTraffic">点击量: </label>
                                        <input type="number" value="0" placeholder="点击量" id="updateTraffic">
                                    </div>
                                </div>
                                <div class="row form-group" >
                                    <div class="col-md-4 col-md-offset-5">
                                        <button  class="btn btn-primary"  onclick="submitUpdate()">提交</button>
                                        <button  class="btn btn-default " onclick="returnBack($('#updateArticleDiv'))">取消</button>
                                    </div>
                                </div>
                            </div>
							<!--文章列表-->
							<div class="col-md-12" id="dataTableDiv">
								<h3 class="header smaller lighter blue">文章列表</h3>

								<div class="clearfix">
									<div class="pull-right tableTools-container"></div>
								</div>
								<!-- div.table-responsive -->

								<!-- div.dataTables_borderWrap -->
								<div>
									<table id="table" class="table table-striped table-bordered table-hover" style='text-align: center'>
										<thead>
											<th class="center">
												<label class="pos-rel">
													<input type="checkbox" class="ace" />
													<span class="lbl"></span>
												</label>
											</th>
											<th style="text-align: center"><span>ID</span></th>
											<th style="text-align: center"><span>标题</span></th>
											<th style="text-align: center"><span>简介</span></th>
											<th style="text-align: center"><span>所属分类</span></th>
											<th style="text-align: center"><span>置顶</span></th>
											<th style="text-align: center"><span>隐藏</span></th>
											<th style="text-align: center"><span>点击量</span></th>
											<th style="text-align: center"><span>创建时间</span></th>
											<th style="text-align: center"><span>操作</span></th>
										</thead>
										<tbody></tbody>
									</table>
								</div>
							</div>
						</div>

						<!-- PAGE CONTENT ENDS -->
					</div><!-- /.col -->
				</div><!-- /.row --><!-- /.row -->
					</div><!-- /.page-content -->
				</div>
			</div><!-- /.main-content -->

			<div class="footer">
				<div class="footer-inner">
					<div class="footer-content">
						<span class="bigger-120">
							<span class="blue bolder">ZhouJianGuo's Blog</span>
							 &copy; 2019
						</span>
					</div>
				</div>
			</div>

			<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
				<i class="ace-icon fa fa-angle-double-up icon-only bigger-110"></i>
			</a>
		</div><!-- /.main-container -->

		<!-- basic scripts -->

		<!--[if !IE]> -->
		<script src="/admin/assets/js/jquery-2.1.4.min.js"></script>

		<!-- <![endif]-->

		<!--[if IE]>
        <script src="/admin/assets/js/jquery-1.11.3.min.js"></script>
        <![endif]-->
		<script type="text/javascript">
			if('ontouchstart' in document.documentElement) document.write("<script src='/admin/assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
		</script>
		<script src="/admin/assets/js/bootstrap.min.js"></script>
		<!-- page specific plugin scripts -->
		<script src="/admin/assets/js/jquery.ui.touch-punch.min.js"></script>

		<!-- ace scripts -->
		<script src="/admin/assets/js/ace-elements.min.js"></script>
		<script src="/admin/assets/js/ace.min.js"></script>

		<!-- page specific plugin scripts -->
		<script src="/admin/assets/js/jquery.dataTables.min.js"></script>
		<script src="/admin/assets/js/jquery.dataTables.bootstrap.min.js"></script>
		<script src="/admin/assets/js/dataTables.buttons.min.js"></script>
		<script src="/admin/assets/js/buttons.flash.min.js"></script>
		<script src="/admin/assets/js/buttons.html5.min.js"></script>
		<script src="/admin/assets/js/buttons.print.min.js"></script>
		<script src="/admin/assets/js/buttons.colVis.min.js"></script>
		<script src="/admin/assets/js/dataTables.select.min.js"></script>
		<script src="/admin/assets/js/sweetalert-dev.js"></script>
		<script src="/admin/ckeditor/ckeditor.js"></script>
		<script src="/admin/assets/js/bootstrap-tag.min.js"></script>
		<script src="/admin/assets/js/jquery.highlight.js"></script>

		<!--page sources scripts-->
		<script type="text/javascript">
			//删除指定id的文章
			function deleteArticle(id) {
				swal({
					title:'注意',
					text:'即将删除该文章，无法恢复！',
					type:'warning',
					showCancelButton:true,
					confirmButtonColor: "#DD6B55",
					confirmButtonText: "确定删除！",
					cancelButtonText: "取消删除！",
					closeOnConfirm: false,
					closeOnCancel: true
				},
				function(isConfirm){
					if (isConfirm) {
						$.ajax({
							type:'delete',
							dataType:'json',
							url:'/admin/article/'+id,
							success:function (data) {
								if(data.code==200){
									swal("成功", "id为"+id+"的文章已被成功删除","success");
									$("#table > thead > tr > th >label >input[type=checkbox]").prop('checked', false)
									dataTable.ajax.reload();
								}
							}
						})
					}})
			}

			var dataTable = $('#table').DataTable( {
				ordering:true,
				searching:true,
				serverSide:true,
				ajax:{
					url:'/admin/article/list',
					type:'get'
				},
				columns:[
					{data:null},
					{data:'id'},
					{data:'title'},
					{data:'summary'},
					{data:'categoryName'},
					{data:'top'},
					{data:'privated'},
					{data:'traffic'},
					{data:'createBy'},
					{data:null}
				],
				columnDefs:[
					{//这个就是用来画第一列的小方块多选框的
						targets : 0,
						searchable : false,
						orderable : false,
						render : function(data, type, row) {
							var html="<label class='pos-rel'>"
							html+="<input type='checkbox'class='ace' />"
							html+="<span class='lbl'></span>"
							html+="</label>"
							return html;
						}
					},
					{
						targets:5,
						render:function (data, type, row, meta) {
							var html=""
							if(data==true){
								html+="<span class='label label-success'>置顶</span>"
							}else{
								html+="<span class='label label-danger'>未置顶</span>"
							}
							return html
						}
					},
					{
						targets:6,
						render:function (data, type, row, meta) {
							var html=""
							if(data==true){
								html+="<span class='label label-success'>隐藏</span>"
							}else{
								html+="<span class='label label-danger'>未隐藏</span>"
							}
							return html
						}
					},
					{
						orderable:false,
						targets:9,
						render:function (data, type, row, meta) {
							var html="<div class='hidden-sm hidden-xs action-buttons'>\
									<a class='green' onclick='initUpdate("+row.id+")'><i class='ace-icon fa fa-pencil bigger-130'></i></a>\
									<a class='red' onclick='deleteArticle("+row.id+")'><i class='ace-icon fa fa-trash-o bigger-130'></i></a></div></td>\
									</div>"
							return html;
						}
					}

				],
				select : {
					style : 'multi',
					selector:'td:checkbox'
				},
				order:[1,'desc'],
				lengthMenu: [ 5, 10, 20 ],
				language:{
					"decimal":        "",
					"emptyTable":     "空数据",
					"info":           "当前为第 _START_ 到 _END_ 条数据,总共 _TOTAL_ 条数据",
					"infoEmpty":      "当前显示 0 条数据",
					"infoFiltered":   "(总共 _MAX_ 条数据)",
					"infoPostFix":    "",
					"thousands":      ",",
					"lengthMenu":     "显示 _MENU_ 条数据",
					"loadingRecords": "加载中...",
					"processing":     "处理中...",
					"search":         "查找(标题):",
					"zeroRecords":    "未能找到相关数据",
					"paginate": {
						"first":      "首页",
						"last":       "末页",
						"next":       "下一页",
						"previous":   "上一页"
					},
					"aria": {
						"sortAscending":  ": activate to sort column ascending",
						"sortDescending": ": activate to sort column descending"
					}
				}
			} );
			$.fn.dataTable.Buttons.defaults.dom.container.className = 'dt-buttons btn-overlap btn-group btn-overlap';

			new $.fn.dataTable.Buttons( dataTable, {
				buttons: [
					{   "extend": "colvis",
						"text": "<i class='fa fa-eye bigger-110 blue'></i> <span class='hidden'>显示/隐藏指定列</span>",
						"className": "btn btn-white btn-primary btn-bold"
					},
					{
						"text": "<i class='fa fa-plus' ></i> <span class='hidden'>添加新文章</span>",
						"className": "btn btn-white btn-success btn-bold",
						"action":function () {
							initCategorySelect($("#addCategoryId"))
							$("#dataTableDiv").fadeOut(500)
							$("#addArticleDiv").fadeIn(500)
						}
					},
					{
						"text":"<i class='fa fa-trash' ></i> <span class='hidden'>批量删除</span>",
						"className": "btn btn-white btn-danger btn-bold",
						"action":function(){//删除
							var array = new Array();
							array = dataTable.rows({selected : true}).data().toArray();
							if(array.length==0){//如果一个没有勾选
								swal({    //提示框
									title : "批量删除失败",
									text : "请先勾选需要删除的数据",
									type : "error",
									showConfirmButton : true,
								});
							}else{
								swal({
									title : "批量删除",
									text : "即将批量删除所选文章!",
									type : "warning",
									showCancelButton : true,
									confirmButtonColor: "#DD6B55",
									confirmButtonText : "确定删除",
									cancelButtonText : "取消删除",
									closeOnConfirm : false,
								}, function() {
									for (var i = 0; i < array.length; i++) {
										$.ajax({
											type:'delete',
											dataType:'json',
											url:'/admin/article/'+array[i].id,
											async:false,
											success:function (data) {
												if(data.code!=200){
													swal("出错啦！","批量删除文章时出错！","error")
												}
											}
										})//确定删除，则执行删除函数
										dataTable.ajax.reload()
										$("#table > thead > tr > th >label >input[type=checkbox]").prop('checked', false)
										swal("删除成功","批量删除："+array.length+"篇文章成功！","success")
									}
								});
							}
						}
					}
				]
			} );


			dataTable.buttons().container().appendTo( $('.tableTools-container') );
			var defaultColvisAction = dataTable.button(0).action();
			dataTable.button(0).action(function (e, dt, button, config) {

				defaultColvisAction(e, dt, button, config);


				if($('.dt-button-collection > .dropdown-menu').length == 0) {
					$('.dt-button-collection')
						.wrapInner('<ul class="dropdown-menu dropdown-light dropdown-caret dropdown-caret" />')
						.find('a').attr('href', '#').wrap("<li />")
				}
				$('.dt-button-collection').appendTo('.tableTools-container .dt-buttons')
			});
			setTimeout(function() {
				$($('.tableTools-container')).find('a.dt-button').each(function() {
					var div = $(this).find(' > div').first();
					if(div.length == 1) div.tooltip({container: 'body', title: div.parent().text()});
					else $(this).tooltip({container: 'body', title: $(this).text()});
				});
			}, 500);

			//table checkboxes
			$('th input[type=checkbox], td input[type=checkbox]').prop('checked', false);

			//select/deselect all rows according to table header checkbox
			$('#table > thead > tr > th input[type=checkbox], #table_wrapper input[type=checkbox]').eq(0).on('click', function(){
				var th_checked = this.checked;//checkbox inside "TH" table header
				if(th_checked){
					$('td input[type=checkbox]').prop('checked',true);
				}else{
					$('td input[type=checkbox]').prop('checked',false);
				}

				$('#table').find('tbody > tr').each(function(){
					var row = this;
					if(th_checked) dataTable.row(row).select();
					else  dataTable.row(row).deselect();
				});
			});

			//select/deselect a row when the checkbox is checked/unchecked
			$('#table').on('click', 'td input[type=checkbox]' , function(){
				var row = $(this).closest('tr').get(0);
				if(this.checked) dataTable.row(row).select();
				else dataTable.row(row).deselect();
			});


			//  markdown 插件部分
			//add部分
			function submitAdd(){
				swal({
							title:'注意',
							text:'即将发布该文章，确认发布！',
							type:'warning',
							showCancelButton:true,
							confirmButtonColor: "#DD6B55",
							confirmButtonText: "发布！",
							cancelButtonText: "emmm 再改改··",
							closeOnConfirm: false,
							closeOnCancel: true
						},
						function(isConfirm){
							if (isConfirm) {
								var data={};
								data.title=$("#addTitle").val();
								data.summary=$("#addSummary").val();
								data.pictureUrl=$("#addPictureUrl").attr('url');
								data.content=CKEDITOR.instances.addContent.getData()
								data.categoryId=$("#addCategoryId").val();
								data.traffic=$("#addTraffic").val();
								data.top=$('input[name="addTop"]:checked').val();
								data.privated=$('input[name="addPrivate"]:checked').val();
								data.tagList=$('#addTags').data('tag').values
								//alert(JSON.stringify(data));
									$.ajax({
										data:JSON.stringify(data),
										contentType:'application/json',
										type:'post',
										dataType:'json',
										url:'/admin/article',
										success:function (result) {
											if(result.code==200){
												swal({
													title:'成功',
													text:'新增文章成功！',
													type:'success'
												},function(isConfirm){
													location.reload();
												})
											}
										}

									})
							}})

			}
			CKEDITOR.replace('addContent')
			//update部分
			function initUpdate(id){
				initCategorySelect($("#updateCategoryId"))
				$("#updateArticleDiv").fadeIn(500)
				$("#dataTableDiv").fadeOut(500)
				$.ajax({
					type:'get',
					url:'/admin/article/'+id,
					dataType:'json',
                    success:function (result) {
						//alert(JSON.stringify(result))
						if(result.code==200){
							$("#updateId").val(result.article.id);
							$("#updateTitle").val(result.article.title);
							$("#updateSummary").val(result.article.summary);
							$("#updatePictureUrl").attr("url",result.article.pictureUrl)
                            CKEDITOR.instances.updateContent.setData(result.article.content)
							$("[name='updateTop'][value="+result.article.top+"]").prop("checked", "checked");
							$("[name='updatePrivate'][value="+result.article.privated+"]").prop("checked", "checked");
							$("#updateCategoryId").val(result.article.categoryId)
							$("#updateTraffic").val(result.article.traffic)
                            // var index = $("#updateTags").data('tag').inValues('mysql');
                            // $("#updateTags").data('tag').remove(index);
                            for(var i=0;i<10;i++){
                                $("#updateTags").data('tag').remove(i);
                            }
							for(var i=0;i<result.article.tagList.length;i++){
								$("#updateTags").data('tag').add(result.article.tagList[i])
							}
						}
					}
				})
			}
			function submitUpdate(){
                swal({
                        title:'注意',
                        text:'即将修改该文章，请确认修改！',
                        type:'warning',
                        showCancelButton:true,
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: "修改！",
                        cancelButtonText: "emmm 再看看··",
                        closeOnConfirm: false,
                        closeOnCancel: true
                    },
                    function(isConfirm){
                        if (isConfirm) {
                            var data={};
                            data.title=$("#updateTitle").val();
                            data.summary=$("#updateSummary").val();
                            data.pictureUrl=$("#updatePictureUrl").attr('url');
                            data.content=CKEDITOR.instances.updateContent.getData()
                            data.categoryId=$("#updateCategoryId").val();
                            data.traffic=$("#updateTraffic").val();
                            data.top=$('input[name="updateTop"]:checked').val();
							data.privated=$('input[name="updatePrivate"]:checked').val();
							data.tagList=$("#updateTags").data('tag').values;
                           	//alert(JSON.stringify(data));
                            $.ajax({
                                data:JSON.stringify(data),
                                contentType:'application/json',
                                type:'put',
                                dataType:'json',
                                url:'/admin/article/'+$("#updateId").val(),
                                success:function (result) {
                                    if(result.code==200){
                                    	swal({
											title:'成功',
											text:'提交修改成功！',
											type:'success'
										},function(isConfirm){
                                    		location.reload();
										})
                                    }
                                }

                            })
                        }})
			}
            CKEDITOR.replace('updateContent')

			//上传封面图片
			function uploadPicture(obj){
				var reqData=new FormData();
				reqData.append("upload",obj[0].files[0]);
				$.ajax({
					data:reqData,
					url:'/admin/upload/images',
					type:'post',
					processData: false,
					contentType: false,
					dataType:'json',
					xhrFields:{
						withCredentials:true
					},
					success:function (result) {
						if(result.code==200){
							swal("提示","上传封面成功","success")
							obj.attr('url',result.url)
						}else{
							swal("提示","上传封面失败","error")
						}
					}
				})
			}
			//公共部分
			function initCategorySelect(selectObj){
				selectObj.html('')
				$.ajax({
					dataType:'json',
					type:'get',
					url:'/admin/category/all',
					success:function (data) {
						//	alert(JSON.stringify(data))
						if(data.code==200){
							for(var i=0;i<data.total;i++){
								selectObj.append("<option value='"+data.rows[i].id+"'>"+data.rows[i].name+data.rows[i].number+"篇</option>")

							}
						}
					}
				})
			}
			function returnBack(divObj) {
				divObj.fadeOut(500)
				$("#dataTableDiv").fadeIn(500)
			}
			$('.uploadFile').ace_file_input({
				no_file:'没有封面',
				btn_choose:'选择',
				btn_change:'重新选择',
				droppable:false,
				onchange:null,
				thumbnail:true
			});
			//添加文章tag
			var addTags = $('#addTags');
			try {
				addTags.tag(
						{
							placeholder: addTags.attr('placeholder'),
							 source: function(query, process) {
								 var data=new Array();
								//alert(JSON.stringify($('#addTags').data('tag').values))
								 $.ajax({
									 url: '/admin/tag/name/like?tagName='+query,
									 type:'get',
									 async:'false',
									 dataType:'json',
									 success:function (result) {
										 if(result.code==200){
										 	for(var i=0;i<result.data.length;i++){
												data.push(result.data[i].name)
											}
										 }
										 process(data)
									 }
								 })
							 }
						}
				)

				// var $tag_obj = $('#addTags').data('tag');
                //
				// var index = $tag_obj.inValues('some tag');
				// $tag_obj.remove(index);
			} catch (e) {
				//display a textarea for old IE, because it doesn't support this plugin or another one I tried!
				addTags.after('<textarea id="' + addTags.attr('id') + '" name="' + addTags.attr('name') + '" rows="3">' + addTags.val() + '</textarea>').remove();
				//autosize($('#addTags'));
			}
			//修改文章tag
			var updateTags = $('#updateTags');
			try {
				updateTags.tag(
						{
							placeholder: updateTags.attr('placeholder'),
							source: function(query, process) {
								var data=new Array();
								//alert(JSON.stringify($('#updateTags').data('tag').values))
								$.ajax({
									url: '/admin/tag/name/like?tagName='+query,
									type:'get',
									async:'false',
									dataType:'json',
									success:function (result) {
										if(result.code==200){
											for(var i=0;i<result.data.length;i++){
												data.push(result.data[i].name)
											}
										}
										process(data)
									}
								})
							}
						}
				)

				//programmatically add/remove a tag
				// var $tag_obj = $('#updateTags').data('tag');
                //
				// var index = $tag_obj.inValues('some tag');
				// $tag_obj.remove(index);
			} catch (e) {
				//display a textarea for old IE, because it doesn't support this plugin or another one I tried!
				updateTags.after('<textarea id="' + updateTags.attr('id') + '" name="' + updateTags.attr('name') + '" rows="3">' + updateTags.val() + '</textarea>').remove();
				//autosize($('#updateTags'));
			}
			//search highlight
			dataTable.on('draw', function () {
				var body = $(dataTable.table().body());
				body.unhighlight();
				body.highlight(dataTable.search());
			});
		</script>
	</body>
</html>
